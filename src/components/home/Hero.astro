---
import { Picture } from "astro:assets";

interface Props {
    images?: string[];
}
const { images } = Astro.props;
---

<section class="relative h-[500px] overflow-hidden group">
    {
        images?.map((img, index) => (
            <Picture
                alt={`Hero Image ${index + 1}`}
                class={`w-full h-full object-cover absolute inset-0 transition-opacity duration-1000 ${index === 0 ? "opacity-100" : "opacity-0"}`}
                src={img}
                formats={["avif", "webp"]}
                data-hero-image
                data-index={index}
                inferSize
            />
        ))
    }
    <div class="absolute inset-0 hero-gradient"></div>

    <div class="absolute inset-0 flex items-center justify-center">
        <div class="flex space-x-2 z-10">
            {
                images?.map((_, index) => (
                    <button
                        class={`w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? "bg-white scale-125" : "border-2 border-white bg-transparent"}`}
                        data-hero-indicator
                        data-index={index}
                        aria-label={`Go to slide ${index + 1}`}
                    />
                ))
            }
        </div>
    </div>
</section>

<script>
    const images = document.querySelectorAll("[data-hero-image]");
    const indicators = document.querySelectorAll("[data-hero-indicator]");
    let currentIndex = 0;
    const totalImages = images.length;
    const INTERVAL = 10000; // 10000 = 10 seconds

    function updateSlider(index: number) {
        // Update images
        images.forEach((img, i) => {
            if (i === index) {
                img.classList.remove("opacity-0");
                img.classList.add("opacity-100");
            } else {
                img.classList.remove("opacity-100");
                img.classList.add("opacity-0");
            }
        });

        // Update indicators
        indicators.forEach((ind, i) => {
            if (i === index) {
                ind.classList.remove("border-2", "bg-transparent");
                ind.classList.add("bg-white", "scale-125");
            } else {
                ind.classList.remove("bg-white", "scale-125");
                ind.classList.add("border-2", "border-white", "bg-transparent");
            }
        });

        currentIndex = index;
    }

    function nextSlide() {
        const nextIndex = (currentIndex + 1) % totalImages;
        updateSlider(nextIndex);
    }

    let slideInterval = setInterval(nextSlide, INTERVAL);

    // Optional: Pause on manual interaction (if buttons were interactive for click)
    indicators.forEach((btn) => {
        btn.addEventListener("click", (e) => {
            const index = parseInt(
                (e.target as HTMLElement).dataset.index || "0",
            );
            updateSlider(index);
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, INTERVAL);
        });
    });
</script>

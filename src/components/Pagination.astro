---
import type { Page } from "astro";

interface Props {
    page: Page<any>;
    baseUrl: string;
}

const { page, baseUrl } = Astro.props;

// Pagination Helper
type PageItem =
    | { type: "page"; num: number; href: string; isCurrent: boolean }
    | { type: "ellipsis" };
const pageItems: PageItem[] = [];

for (let i = 1; i <= page.lastPage; i++) {
    const showPage =
        i === 1 || i === page.lastPage || Math.abs(i - page.currentPage) <= 1;
    const showEllipsisBefore =
        i === page.currentPage - 2 && page.currentPage > 3;
    const showEllipsisAfter =
        i === page.currentPage + 2 && page.currentPage < page.lastPage - 2;

    if (showEllipsisBefore || showEllipsisAfter) {
        pageItems.push({ type: "ellipsis" });
    } else if (showPage) {
        pageItems.push({
            type: "page",
            num: i,
            href: i === 1 ? baseUrl : `${baseUrl}/${i}`,
            isCurrent: i === page.currentPage,
        });
    }
}
---

{
    page.lastPage > 1 && (
        <nav
            class="mt-12 flex justify-center items-center"
            aria-label="Pagination"
        >
            <ul class="flex items-center gap-1">
                {/* First Page Button */}
                {page.currentPage > 2 && (
                    <li>
                        <a
                            href={baseUrl}
                            class="flex items-center justify-center size-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                            aria-label="Halaman pertama"
                        >
                            <span class="material-icons-outlined text-sm">
                                first_page
                            </span>
                        </a>
                    </li>
                )}

                {/* Previous Button */}
                {page.url.prev && (
                    <li>
                        <a
                            href={page.url.prev}
                            class="flex items-center justify-center size-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                            aria-label="Halaman sebelumnya"
                        >
                            <span class="material-icons-outlined text-sm">
                                chevron_left
                            </span>
                        </a>
                    </li>
                )}

                {/* Page Numbers */}
                {pageItems.map((item) =>
                    item.type === "ellipsis" ? (
                        <li>
                            <span class="flex items-center justify-center size-10 text-slate-400 dark:text-slate-600">
                                ...
                            </span>
                        </li>
                    ) : (
                        <li>
                            <a
                                href={item.href}
                                class={
                                    item.isCurrent
                                        ? "flex items-center justify-center size-10 rounded-lg font-medium transition-colors bg-primary text-white border border-primary shadow-lg shadow-primary/25"
                                        : "flex items-center justify-center size-10 rounded-lg font-medium transition-colors border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-primary hover:text-white hover:border-primary"
                                }
                                aria-current={
                                    item.isCurrent ? "page" : undefined
                                }
                            >
                                {item.num}
                            </a>
                        </li>
                    ),
                )}

                {/* Next Button */}
                {page.url.next && (
                    <li>
                        <a
                            href={page.url.next}
                            class="flex items-center justify-center size-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                            aria-label="Halaman selanjutnya"
                        >
                            <span class="material-icons-outlined text-sm">
                                chevron_right
                            </span>
                        </a>
                    </li>
                )}

                {/* Last Page Button */}
                {page.currentPage < page.lastPage - 1 && (
                    <li>
                        <a
                            href={`${baseUrl}/${page.lastPage}`}
                            class="flex items-center justify-center size-10 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                            aria-label="Halaman terakhir"
                        >
                            <span class="material-icons-outlined text-sm">
                                last_page
                            </span>
                        </a>
                    </li>
                )}
            </ul>
        </nav>
    )
}
